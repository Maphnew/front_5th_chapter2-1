import"./modulepreload-polyfill-B5Qt9EMX.js";let d={lastSelectedProduct:null,stock:{p1:{name:"상품1",price:1e4,quantity:50,originQty:50},p2:{name:"상품2",price:2e4,quantity:30,originQty:30},p3:{name:"상품3",price:3e4,quantity:20,originQty:20},p4:{name:"상품4",price:15e3,quantity:0,originQty:0},p5:{name:"상품5",price:25e3,quantity:10,originQty:10}}};const C={p1:0,p2:0,p3:0,p4:0,p5:0},O=e=>{const t={get(c,r){return Reflect.get(c,r)},set:(c,r,o)=>(d.stock[r].quantity=d.stock[r].originQty-o,c[r]=o,e(),!0)};return{cartState:new Proxy(C,t),state:d}};let m;const g=()=>(m||(m=document.getElementById("main")),m.content.firstElementChild.cloneNode(!0)),h=()=>g(),f=e=>{e.querySelector("#add-to-cart").addEventListener("click",()=>{const n=document.querySelector("#product-select").value,c={...a.stock[n]};if(!c||c.quantity<=0){alert("재고가 부족합니다.");return}i[n]++,a.lastSelectedProduct=n})},D=e=>{e.querySelector("#cart-items").addEventListener("click",t=>{const n=t.target;if(n.classList.contains("remove-item")){const c=n.dataset.productId,r=i[c];i[c]-=r}})},I=e=>{e.querySelector("#cart-items").addEventListener("click",t=>{const n=t.target;if(n.classList.contains("quantity-change")){const c=n.dataset.productId,r=parseInt(n.dataset.change);if(a.stock[c].quantity===0){alert("재고가 부족합니다.");return}i[c]+=r}})},R=e=>{const t=e.cloneNode(!0);return t.innerHTML="",t.appendChild(h()),f(t),D(t),I(t),t},s={THUNDER:.2,ADDITIONAL:.05,EACH_PRODUCT:{QUANTITY:10,RATIO:{p1:.1,p2:.15,p3:.2,p4:.05,p5:.25}},ALL_PRODUCT:{QUANTITY:30,RATIO:.25}},E=()=>{const e=a.stock["p"+(Math.floor(Math.random()*Object.keys(a.stock).length)+1).toString()];Math.random()<.3&&e.quantity>0&&(e.price=Math.round(e.price*(1-s.THUNDER)),alert("번개세일! "+e.name+"이(가) 20% 할인 중입니다!"),p())},k=()=>{setTimeout(()=>{setInterval(E,3e4)},Math.random()*1e4)},q=()=>{if(a.lastSelectedProduct){const e=Object.entries(a.stock).map(([t,n])=>({id:t,...n})).find(t=>t.id!==a.lastSelectedProduct&&t.quantity>0);e&&(alert(e.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),e.price=Math.round(e.price*(1-s.ADDITIONAL)),p())}},S=()=>{setTimeout(()=>{setInterval(q,6e4)},Math.random()*2e4)},L=()=>new Date().getDay()===2,P=(e,t)=>{if(e>=s.EACH_PRODUCT.QUANTITY){if(t==="p1")return s.EACH_PRODUCT.RATIO[t];if(t==="p2")return s.EACH_PRODUCT.RATIO[t];if(t==="p3")return s.EACH_PRODUCT.RATIO[t];if(t==="p4")return s.EACH_PRODUCT.RATIO[t];if(t==="p5")return s.EACH_PRODUCT.RATIO[t]}return 0},U=()=>{let e=Object.values(i).reduce((r,o)=>r+o,0),t=Object.entries(i).reduce((r,[o,u])=>r+a.stock[o].price*u,0),n=Object.entries(i).reduce((r,[o,u])=>{const y=a.stock[o].price*u;let A=P(u,o);return r+y*(1-A)},0),c=(t-n)/t;if(e>=s.ALL_PRODUCT.QUANTITY){const r=n*s.ALL_PRODUCT.RATIO,o=t-n;r>o&&(n=t*(1-s.ALL_PRODUCT.RATIO),c=s.ALL_PRODUCT.RATIO)}return L()&&(n*=1-.1,c=Math.max(c,.1)),{totalAmount:n,discountRate:c}},T=()=>{const{totalAmount:e,discountRate:t}=U();_(e),H(t),x(),M(e),b()};let{cartState:i,state:a}=O(T);const l=e=>document.querySelector(e),N=()=>{const e=l("#app");e.replaceWith(R(e)),T(),p(),k(),S()},$=({id:e,name:t,price:n,quantity:c})=>{const o=document.getElementById("cart-item").content.firstElementChild.cloneNode(!0);return o.id=e,o.querySelector("span").textContent=t+" - "+n+"원 x "+c,Array.from(o.querySelectorAll("button")).forEach(u=>{u.setAttribute("data-product-id",e)}),o},b=()=>{const e=l("#cart-items");e.innerHTML="",Object.entries(i).filter(([t,n])=>n>0).map(([t,n])=>$({...a.stock[t],id:t,quantity:n})).forEach(t=>{console.log(t),e.appendChild(t)})},_=e=>{const t=l("#cart-total");t.textContent="총액: "+Math.round(e)+"원"},H=e=>{if(isNaN(e)||e<=0)return;const t=l("#cart-total");let n=document.createElement("span");n.className="text-green-500 ml-2",n.textContent="("+(e*100).toFixed(1)+"% 할인 적용)",t.appendChild(n)},M=e=>{const t=Math.floor(e/1e3),n=l("#cart-total");let c=l("#loyalty-points");c||(c=document.createElement("span"),c.id="loyalty-points",c.className="text-blue-500 ml-2",n.appendChild(c)),c.textContent="(포인트: "+t+")"},x=()=>{const e=Object.entries(a.stock).filter(([n,c])=>c.quantity<5).map(([n,c])=>c.quantity>0?`${c.name}: 재고 부족 (${c.quantity}개 남음)`:`${c.name}: 품절`).join(`
`),t=l("#stock-status");t.textContent=e},p=()=>{const e=l("#product-select");e.innerHTML="",Object.entries(a.stock).forEach(([t,n])=>{const c=document.createElement("option");c.value=t,c.textContent=n.name+" - "+n.price+"원",n.quantity===0&&(c.disabled=!0),e.appendChild(c)})};N();
